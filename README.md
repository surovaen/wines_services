# Celery-сервисы

Микросервисы:
1) Django + Celery + PostgreSQL + RabbitMQ

Реализация добавления, изменения и удаления вин (Код - Наименование) в БД через админ-панель.
Любое из вышеперечисленных действий отправляет изменения в остальные сервисы для обновления данных.
В админ-панели добавлена кнопка "Обновить данные", перезаписывающая все данные из БД в других сервисах.

Реализована периодическая задача, отправляющая рандомное вино в первый flask-сервис, который отправляет следующее по порядку вино в следующий flask-сервис, и так далее.
Последний flask-сервис возвращает в django-сервис данные по вину, которые записываются в лог, осуществляется проверка на корректность кода возвращенного вина в 
зависимости от количества flask-сервисов.
2) Flask + Celery + RabbitMQ

Реализация контейнера, хранящего данные по винам, отсортированные по коду.


## Используемые технологии
Бэкенд: python3.10, django, gunicorn, celery, celery-beat, flask, flower

СУБД: PostgreSQL

Брокер: RabbitMQ

Линтеры: isort, flake8

## Настройка проекта

Проект настраивается через переменные окружения, указанные в файле src/.env

Пример .env файла указан в .env.example:

| Ключ                | Значение                           | По умолчанию          |
|---------------------|------------------------------------|-----------------------|
| `SECRET_KEY`        | Секретный ключ                     | `the-most-secret-key` |
| `DEBUG`             | Режим дебага                       | `True`                |
| `POSTGRES_DB`       | Имя БД                             | `wines`               |
| `POSTGRES_USER`     | Пользователь БД                    | `postgres`            |
| `POSTGRES_PASSWORD` | Пароль пользователя БД             | `postgres`            |
| `POSTGRES_HOST`     | Адрес СУБД                         | `db`                  |
| `POSTGRES_PORT`     | Порт СУБД                          | `5432`                |
| `RABBIT_HOST `      | Адрес брокера                      | `rabbitmq`            |
| `RABBIT_PORT `      | Порт брокера                       | `5672`                |
| `SERVICES_COUNT`    | Количество сервисов flask          | `2`                   |
| `STATIC_PATH`       | Путь до статических файлов         | `/project/static`     |
| `APP_PROXY_PORT`    | Порт контейнера с бэкендом         | `8000`                |
| `APP_PROXY_LINK`    | Наименование контейнера с бэкендом | `app`                 |


В docker-compose.yml описаны один django-сервис и два flask-сервиса. 
При добавлении новых flask-сервисов необходимо передать порядковый номер сервиса (SERVICE_NUMBER) в build args.
В переменной SERVICES_COUNT необходимо указать количество поднятых flask-сервисов.

## Запуск проекта:

В корне проекта запустить команду:

`docker-compose -f docker-compose.yml up --build -d`

Доступ к админ-панели: `127.0.0.1:8000/admin`

Для создания администратора в контейнере "django-app" необходимо запустить команду:

`python manage.py createsuperuser`

Доступ к Flower: `127.0.0.1:5555`

